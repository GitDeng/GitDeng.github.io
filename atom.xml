<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[程序员笔记]]></title>
  <link href="http://gitdeng.github.io/atom.xml" rel="self"/>
  <link href="http://gitdeng.github.io/"/>
  <updated>2015-07-21T23:59:58+08:00</updated>
  <id>http://gitdeng.github.io/</id>
  <author>
    <name><![CDATA[程序员笔记]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Android实战项目——倒计时]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/21/Android-project-actual-combat-Countdown/"/>
    <updated>2015-07-21T20:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/21/Android-project-actual-combat-Countdown</id>
    <content type="html"><![CDATA[<h2>项目背景</h2>

<p>在Android系统中UI操作并不是线程安全的，如果多个线程并发的去操作同一个组件，可能导致线程安全问题。为了解决这一个问题，Android 制定了一条规则：只允许 UI 线程来修改 UI 组件的属性等，也就是说必须单线程模型，这样导致如果在UI界面进行一个耗时较长的数据更新等就会形成程序假死现象，也就是ANR异常，如果20秒中没有完成程序就会强制关闭。所以比如另一个线程要修改UI组件的时候，就需要借助Handler消息机制了。</p>

<h2>核心内容</h2>

<p>1 UI布局<br/>
2 Handler创建<br/>
3 计时器创建<br/>
4 逻辑实现</p>

<h2>代码示例</h2>

<h3>1 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.counttime" &gt;
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.counttime;
</span><span class='line'>
</span><span class='line'>import android.os.Handler;
</span><span class='line'>import android.os.Message;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.Button;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>import android.widget.TextView;
</span><span class='line'>
</span><span class='line'>import java.util.Timer;
</span><span class='line'>import java.util.TimerTask;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener{
</span><span class='line'>
</span><span class='line'>    private EditText inputTime;
</span><span class='line'>    private TextView displayTime;
</span><span class='line'>    private Button btnGetTime,btnStartTime,btnStopTime;
</span><span class='line'>    private int countTime = 0;
</span><span class='line'>    private Timer timer;
</span><span class='line'>    private TimerTask timerTask;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        initView();//初始化需要的View
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /**
</span><span class='line'>     * 所有View的初始化全部放在一个initView()方法中，让程序显得更简洁
</span><span class='line'>     */
</span><span class='line'>    private void initView(){
</span><span class='line'>        inputTime = (EditText) findViewById(R.id.inputTime);
</span><span class='line'>        displayTime = (TextView) findViewById(R.id.displayTime);
</span><span class='line'>        btnGetTime = (Button) findViewById(R.id.btnGetTime);
</span><span class='line'>        btnStartTime = (Button) findViewById(R.id.btnStartTime);
</span><span class='line'>        btnStopTime = (Button) findViewById(R.id.btnStopTime);
</span><span class='line'>
</span><span class='line'>        btnGetTime.setOnClickListener(this);
</span><span class='line'>        btnStartTime.setOnClickListener(this);
</span><span class='line'>        btnStopTime.setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnGetTime:
</span><span class='line'>                displayTime.setText(inputTime.getText().toString());//显示倒计时处显示输入的时间
</span><span class='line'>                countTime = Integer.parseInt(inputTime.getText().toString());//获取输入的时间做计时准备
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStartTime:
</span><span class='line'>                startTime();
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopTime:
</span><span class='line'>                stopTime();
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //注意，这里导入的是android.os.Handler这个Handler
</span><span class='line'>    private Handler countHandler = new Handler(){
</span><span class='line'>        @Override
</span><span class='line'>        public void handleMessage(Message msg) {
</span><span class='line'>            super.handleMessage(msg);
</span><span class='line'>            //由于setText()中只能传递字符串，而msg.arg1中传递的数据类型是int型的，需要转换为字符串类型
</span><span class='line'>            displayTime.setText(msg.arg1+"");
</span><span class='line'>            //再次启动计时器，进入循环
</span><span class='line'>            startTime();
</span><span class='line'>        }
</span><span class='line'>    };
</span><span class='line'>
</span><span class='line'>    private void startTime(){
</span><span class='line'>        timer = new Timer();
</span><span class='line'>        timerTask = new TimerTask() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                countTime--;
</span><span class='line'>                Message message = countHandler.obtainMessage();//获取消息
</span><span class='line'>                message.arg1 = countTime;
</span><span class='line'>                countHandler.sendMessage(message);//发送消息
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>        //启动计时器
</span><span class='line'>        timer.schedule(timerTask,1000);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    private void stopTime(){
</span><span class='line'>        timer.cancel();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:id="@+id/inputTime" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="获取倒计时时间(秒)"
</span><span class='line'>        android:id="@+id/btnGetTime" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text=""
</span><span class='line'>        android:id="@+id/displayTime" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="开始计时"
</span><span class='line'>        android:id="@+id/btnStartTime" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止计时"
</span><span class='line'>        android:id="@+id/btnStopTime" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android的权限系统——为基本组件添加权限检查]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Add-permissions-for-basic-components/"/>
    <updated>2015-07-20T18:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Add-permissions-for-basic-components</id>
    <content type="html"><![CDATA[<h2>app模块中</h2>

<h3>1 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.componentpermission;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>            @Override
</span><span class='line'>            public void onClick(View v) {
</span><span class='line'>                startActivity(new Intent(MainActivity.this,MyAty.class));
</span><span class='line'>            }
</span><span class='line'>        });
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyAty.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.componentpermission;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>
</span><span class='line'>public class MyAty extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_my_aty);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.componentpermission" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;!-- 声明一个权限 --&gt;
</span><span class='line'>    &lt;permission android:name="cn.loverobots.componentpermission.permission.MyAty"/&gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MyAty"
</span><span class='line'>            android:label="@string/title_activity_my_aty"
</span><span class='line'>            android:permission="cn.loverobots.componentpermission.permission.MyAty"&gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.DEFAULT"/&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.componentpermission.intent.action.MyAty"/&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动MyAty"
</span><span class='line'>        android:id="@+id/btnStartMyAty" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>5 activity_my_aty.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    tools:context="cn.loverobots.componentpermission.MyAty"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="这是一个被启动的Activity"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>&lt;/RelativeLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h2>anotherApp模块中</h2>

<h3>1 MainActivity.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>            @Override
</span><span class='line'>            public void onClick(View v) {
</span><span class='line'>                startActivity(new Intent("cn.loverobots.componentpermission.intent.action.MyAty"));
</span><span class='line'>            }
</span><span class='line'>        });
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.anotherapp" &gt;
</span><span class='line'>    &lt;!-- 获取启动app中MyAty的启动权限 --&gt;
</span><span class='line'>    &lt;uses-permission android:name="cn.loverobots.componentpermission.permission.MyAty"/&gt;
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动MyAty"
</span><span class='line'>        android:id="@+id/btnStartMyAty" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android的权限系统——为代码添加权限检查]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Add-permissions-for-code-check/"/>
    <updated>2015-07-20T14:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Add-permissions-for-code-check</id>
    <content type="html"><![CDATA[<h3>1 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.checkpermissionincode;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        Hello.sayHello(this);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 Hello.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.checkpermissionincode;
</span><span class='line'>
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.pm.PackageManager;
</span><span class='line'>
</span><span class='line'>public class Hello {
</span><span class='line'>    public static final String PERMISSION_SAY_HELLO = "cn.loverobots.checkpermissionincode.permission.SAY_HELLO";
</span><span class='line'>    public static void sayHello(Context context){
</span><span class='line'>        int checkResult = context.checkCallingOrSelfPermission(PERMISSION_SAY_HELLO);
</span><span class='line'>        if(checkResult != PackageManager.PERMISSION_GRANTED){
</span><span class='line'>            throw new SecurityException("执行sayHello方法需要有cn.loverobots.checkpermissionincode.permission.SAY_HELLO权限");
</span><span class='line'>        }
</span><span class='line'>        System.out.println("Hello JACK的机器人");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.checkpermissionincode" &gt;
</span><span class='line'>    &lt;permission android:name="cn.loverobots.checkpermissionincode.permission.SAY_HELLO"/&gt;
</span><span class='line'>    &lt;!-- 不使用uses-permission获取权限，会抛出一个自定义的错误提示“执行sayHello方法需要有cn.loverobots.checkpermissionincode.permission.SAY_HELLO权限” --&gt;
</span><span class='line'>    &lt;uses-permission android:name="cn.loverobots.checkpermissionincode.permission.SAY_HELLO"/&gt;
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android的权限系统——请求权限实例]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Request-permission-instance/"/>
    <updated>2015-07-20T12:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/20/Android-authority-system-Request-permission-instance</id>
    <content type="html"><![CDATA[<h2>权限系统的目的</h2>

<p>增加权限系统的目的是为了让用户能够查看到当前软件所具有的权限，是一种安全机制，即如果用户不想要将要安装的软件具有此权限，可以拒绝安装。</p>

<h2>代码示例</h2>

<h3>1 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnwebview;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.webkit.WebView;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>    private WebView webView;
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        webView = (WebView) findViewById(R.id.webView);
</span><span class='line'>        webView.loadUrl("http://www.loverobots.cn");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;WebView
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="match_parent"
</span><span class='line'>        android:id="@+id/webView" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnwebview" &gt;
</span><span class='line'>    &lt;!-- 由于没有请求权限，会报错Webpage not available，这时需要通过以下方式获取访问Internet的权限 --&gt;
</span><span class='line'>    &lt;uses-permission android:name="android.permission.INTERNET"/&gt;
</span><span class='line'>    &lt;!-- 增加获取权限的意义是，软件使用用户能够方便用户查看当前软件所具有的权限，是一种权限机制 --&gt;
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android日志系统]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/20/Android-log-system/"/>
    <updated>2015-07-20T08:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/20/Android-log-system</id>
    <content type="html"><![CDATA[<h2>代码示例</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnlog;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.util.Log;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>    //指明Android日志信息是从MainActivity中输出的，且TAG可用于日志分类显示
</span><span class='line'>    private static String TAG = "MainActivity";
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        //Java语言本身提供的日志输出方式
</span><span class='line'>        System.out.println("Java普通日志Info");
</span><span class='line'>        //错误提示信息级别比普通日志信息要高
</span><span class='line'>        System.err.println("Java错误日志Warn");
</span><span class='line'>        //Android提供的日志API，级别从上到下依次降低
</span><span class='line'>        Log.e(TAG,"错误信息");
</span><span class='line'>        Log.w(TAG,"警告信息");
</span><span class='line'>        Log.i(TAG,"普通信息");
</span><span class='line'>        Log.d(TAG,"调试信息");
</span><span class='line'>        Log.v(TAG,"无用信息");//比如一些程序员的唠叨话
</span><span class='line'>        Log.e("MSG","其他信息");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[BroadcastReceiver的优先级]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/20/BroadcastReceiver-priority/"/>
    <updated>2015-07-20T00:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/20/BroadcastReceiver-priority</id>
    <content type="html"><![CDATA[<h2>使用简介</h2>

<p>在AndroidManifest.xml文件中注册receiver时，可在过滤器中增加优先级设置(priority)，数字越大优先级越高，越早执行。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;intent-filter android:priority="7"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>&lt;/intent-filter&gt;</span></code></pre></td></tr></table></div></figure>


<h2>注意事项</h2>

<p>采用abordBroadcast();方法进行广播中断时，不能采用sendBroadcast(new Intent);方式进行广播发送，会报错（BroadcastReceiver trying to return result during a non-ordered broadcast），且不会有中断广播效果。应该采用sendOrderedBroadcast(i,null);方式发送广播。</p>

<h2>代码举例</h2>

<h3>1 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnbroadcastreceiver" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>        &lt;receiver
</span><span class='line'>            android:name=".MyReceiver2"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true"&gt;
</span><span class='line'>            &lt;intent-filter android:priority="7"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/receiver&gt;
</span><span class='line'>        &lt;receiver
</span><span class='line'>            android:name=".MyReceiver"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true"&gt;
</span><span class='line'>            &lt;intent-filter android:priority="8"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/receiver&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.IntentFilter;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private MyReceiver receiver = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSendMsg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnReg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnreg).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch(v.getId()){
</span><span class='line'>            case R.id.btnSendMsg:
</span><span class='line'>//                Intent i = new Intent(this,MyReceiver.class);
</span><span class='line'>                //这时只能隐式Intent传递数据了
</span><span class='line'>                Intent i = new Intent(MyReceiver.ACTION);
</span><span class='line'>                i.putExtra("data","JACK的机器人");
</span><span class='line'>//                sendBroadcast(i);//采用abortBroadcast();中断广播后，不能再采用此方式会报错，不能被中断
</span><span class='line'>                //报错BroadcastReceiver trying to return result during a non-ordered broadcast后，采用方式
</span><span class='line'>                sendOrderedBroadcast(i,null);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnReg:
</span><span class='line'>                //为避免重复注册操作，加入判断条件
</span><span class='line'>                if(receiver == null){
</span><span class='line'>                    //初始化receiver
</span><span class='line'>                    receiver = new MyReceiver();
</span><span class='line'>                    registerReceiver(receiver,new IntentFilter(MyReceiver.ACTION));
</span><span class='line'>                    System.out.println("注册了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnreg:
</span><span class='line'>                if(receiver != null){
</span><span class='line'>                    unregisterReceiver(receiver);
</span><span class='line'>                    receiver = null;
</span><span class='line'>                    System.out.println("注消了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 MyReceiver.java(继承BroadcastReceiver)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver extends BroadcastReceiver {
</span><span class='line'>
</span><span class='line'>    public static final String ACTION = "cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver";
</span><span class='line'>
</span><span class='line'>    public MyReceiver() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>//        System.out.println("接收到了消息，消息的内容是："+intent.getStringExtra("data"));
</span><span class='line'>        System.out.println("MyReceiver 接收到了消息");
</span><span class='line'>        //中断广播可以让优先级比其低的receiver不再接收到消息
</span><span class='line'>        abortBroadcast();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>4 MyReceiver2.java(继承BroadcastReceiver)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver2 extends BroadcastReceiver {
</span><span class='line'>    
</span><span class='line'>    public MyReceiver2() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>        System.out.println("MyReceiver2 接收到了消息");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>5 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="@string/hello_world"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="发送消息"
</span><span class='line'>        android:id="@+id/btnSendMsg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注册接收器"
</span><span class='line'>        android:id="@+id/btnReg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注销接收器"
</span><span class='line'>        android:id="@+id/btnUnreg" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[动态注册和注销BroadcastReceiver]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/19/Dynamic%20registration%20and%20cancellation%20BroadcastReceiver/"/>
    <updated>2015-07-19T01:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/19/Dynamic registration and cancellation BroadcastReceiver</id>
    <content type="html"><![CDATA[<h2>BroadcastReceiver简介</h2>

<p>BroadcastReceiver 是Android 四大基本组件之一，用于接收广播信息，如：开屏、锁屏、短信等等，在实际工作中用途非常广泛。</p>

<h2>动态注册和注销BroadcastReceiver</h2>

<p>有的情况下，我们不希望BroadcastReceiver始终处于侦听状态，这时就需要会注册和注销BroadcastReceiver。</p>

<h3>1 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.IntentFilter;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private MyReceiver receiver = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSendMsg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnReg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnreg).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch(v.getId()){
</span><span class='line'>            case R.id.btnSendMsg:
</span><span class='line'>//                Intent i = new Intent(this,MyReceiver.class);
</span><span class='line'>                //这时只能隐式Intent传递数据了
</span><span class='line'>                Intent i = new Intent(MyReceiver.ACTION);
</span><span class='line'>                i.putExtra("data","JACK的机器人");
</span><span class='line'>                sendBroadcast(i);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnReg:
</span><span class='line'>                //为避免重复注册操作，加入判断条件
</span><span class='line'>                if(receiver == null){
</span><span class='line'>                    //初始化receiver
</span><span class='line'>                    receiver = new MyReceiver();
</span><span class='line'>                    registerReceiver(receiver,new IntentFilter(MyReceiver.ACTION));
</span><span class='line'>                    System.out.println("注册了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnreg:
</span><span class='line'>                if(receiver != null){
</span><span class='line'>                    unregisterReceiver(receiver);
</span><span class='line'>                    receiver = null;
</span><span class='line'>                    System.out.println("注消了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyReceiver.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver extends BroadcastReceiver {
</span><span class='line'>
</span><span class='line'>    public static final String ACTION = "cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver";
</span><span class='line'>
</span><span class='line'>    public MyReceiver() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>        System.out.println("接收到了消息，消息的内容是："+intent.getStringExtra("data"));
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="@string/hello_world"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="发送消息"
</span><span class='line'>        android:id="@+id/btnSendMsg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注册接收器"
</span><span class='line'>        android:id="@+id/btnReg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注销接收器"
</span><span class='line'>        android:id="@+id/btnUnreg" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 AndroidMainfest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnbroadcastreceiver" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[跨应用绑定Servic并通信]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/18/Cross-application-binding-Service-and-communication/"/>
    <updated>2015-07-18T04:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/18/Cross-application-binding-Service-and-communication</id>
    <content type="html"><![CDATA[<p>跨应用绑定Service的目的就是为了数据通信，如果不进行数据通信，跨应用绑定Service也就没有意义了。</p>

<h2>实现方法</h2>

<h3>（app中）</h3>

<h3>1 增加AIDL接口的抽象方法</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>    //步骤1 增加接口抽象方法
</span><span class='line'>    void setData(String data);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 AppService.java中实现接口抽象方法并增加测试线程</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>
</span><span class='line'>    private String data = "默认文本";
</span><span class='line'>    private boolean running = false;
</span><span class='line'>
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>
</span><span class='line'>        return new IAppServiceRemoteBinder.Stub() {
</span><span class='line'>            @Override
</span><span class='line'>            public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {
</span><span class='line'>
</span><span class='line'>            }
</span><span class='line'>            //步骤2 实现接口抽象方法
</span><span class='line'>            @Override
</span><span class='line'>            public void setData(String data) throws RemoteException {
</span><span class='line'>                AppService.this.data = data;
</span><span class='line'>            }
</span><span class='line'>
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>        //步骤3 添加测试线程
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                running = true;
</span><span class='line'>                while (running){
</span><span class='line'>                    System.out.println(data);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>        //步骤4 摧毁线程同时不再输出文本
</span><span class='line'>        running = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>（anotherapp中）</h3>

<h3>3 增加同步测试数据按钮</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动外部服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止外部服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定外部服务"
</span><span class='line'>        android:id="@+id/btnBindAppService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定外部服务"
</span><span class='line'>        android:id="@+id/btnUnbindAppService" /&gt;
</span><span class='line'>    //步骤5 增加同步测试数据按钮
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="这是另一个应用中的数据"
</span><span class='line'>        android:id="@+id/etInput" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="同步数据到绑定的服务中"
</span><span class='line'>        android:id="@+id/btnSync" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 从app中将aidl文件复制至anotherapp中（包名需保持一致）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>//步骤8 拷贝另一个应用中的aidl文件至当前应用中，需保证包名一致。然后Rebuild Project。
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>
</span><span class='line'>    void setData(String data);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>5 修改MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>import cn.loverobots.startservicefromanotherapp.IAppServiceRemoteBinder;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>    private EditText etInput;
</span><span class='line'>    private IAppServiceRemoteBinder binder = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        //步骤7 设置接收编辑文本框数据的对象
</span><span class='line'>        etInput = (EditText) findViewById(R.id.etInput);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnBindAppService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindAppService).setOnClickListener(this);
</span><span class='line'>        //步骤6 绑定同步数据按钮监听事件
</span><span class='line'>        findViewById(R.id.btnSync).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>
</span><span class='line'>            case R.id.btnBindAppService:
</span><span class='line'>                bindService(ServiceIntent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindAppService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                binder = null;
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnSync:
</span><span class='line'>                //步骤9 将文本编辑框中数据通过binder方式传入
</span><span class='line'>                if(binder != null){
</span><span class='line'>                    try {
</span><span class='line'>                        binder.setData(etInput.getText().toString());
</span><span class='line'>                    } catch (RemoteException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Bind Service");
</span><span class='line'>        System.out.println(service);
</span><span class='line'>        //步骤10 绑定服务时，将获取的binder传入。
</span><span class='line'>        //不能使用binder = (IAppServiceRemoteBinder) service;直接进行强制类型转换，因为两者内存地址不一样
</span><span class='line'>        binder = IAppServiceRemoteBinder.Stub.asInterface(service);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>        System.out.println("Unbind Service");
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[跨应用绑定Service]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/18/Cross-application-binding-Service/"/>
    <updated>2015-07-18T03:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/18/Cross-application-binding-Service</id>
    <content type="html"><![CDATA[<h2>1 建立AIDL服务的步骤</h2>

<p>建立AIDL服务要比建立普通的服务复杂一些，具体步骤如下：<br/>
2.1 在Eclipse Android工程的Java包目录中建立一个扩展名为aidl的文件。该文件的语法类似于Java代码，但会稍有不同。<br/>
2.2 如果aidl文件的内容是正确的，ADT会自动生成一个Java接口文件（*.java）。<br/>
2.3 建立一个服务类（Service的子类）。<br/>
2.4 实现由aidl文件生成的Java接口。<br/>
2.5 在AndroidManifest.xml文件中配置AIDL服务，尤其要注意的是，<action>标签中android:name的属性值就是客户端要引用该服务的ID，也就是Intent类的参数值。</p>

<h2>2 跨应用绑定Service</h2>

<p>无法从其它的应用程序里面访问另一个应用程序里面的某一个类的定义，所以Android专门提供了一种机制，即AIDL——Android接口定义语言。</p>

<h3>2.1 创建aidl文件(IAppServiceRemoteBinder.aidl)</h3>

<p>模块名上右键创建AIDL File</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>//步骤1 创建aidl文件
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2.2 当前模块下的AppService类实现aidl接口</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //步骤2 实现aidl接口
</span><span class='line'>        return new IAppServiceRemoteBinder.Stub() {
</span><span class='line'>            @Override
</span><span class='line'>            public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {
</span><span class='line'>
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2.3 在anotherapp中布局文件（activity_main.xml）添加绑定及解绑服务按钮</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动外部服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止外部服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>    &lt;!--步骤3 添加绑定及解绑服务按钮--&gt;
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定外部服务"
</span><span class='line'>        android:id="@+id/btnBindAppService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定外部服务"
</span><span class='line'>        android:id="@+id/btnUnbindAppService" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2.4 给按钮添加监听事件响应(anotherapp中的MainActivity.java)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        //步骤4
</span><span class='line'>        findViewById(R.id.btnBindAppService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindAppService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            //步骤5
</span><span class='line'>            case R.id.btnBindAppService:
</span><span class='line'>                bindService(ServiceIntent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindAppService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //步骤6
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Bind Service");
</span><span class='line'>        System.out.println(service);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>        System.out.println("Unbind Service");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[跨应用启动Service]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/18/Cross-application-startup-Service/"/>
    <updated>2015-07-18T00:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/18/Cross-application-startup-Service</id>
    <content type="html"><![CDATA[<h2>Android中AIDL的理解</h2>

<h3>1 什么是AIDL</h3>

<p>Android系统中的进程之间不能共享内存，因此，需要提供一些机制在不同进程之间进行数据通信。为了使其他的应用程序也可以访问本应用程序提供的服务，Android系统采用了远程过程调用（Remote Procedure Call，RPC）方式来实现。与很多其他的基于RPC的解决方案一样，Android使用一种接口定义语言（Interface Definition Language，IDL）来公开服务的接口。<br/>
我们知道4个Android应用程序组件中的3个（Activity、BroadcastReceiver和ContentProvider）都可以进行跨进程访问，另外一个Android应用程序组件Service同样可以。因此，可以将这种可以跨进程访问的服务称为AIDL（Android Interface Definition Language）服务。</p>

<h3>2 跨应用启动Service</h3>

<p>从Android 5.0开始，如果想启动服务，必须使用显式Intent，不能够使用隐式Intent。</p>

<h2>跨应用启动Service</h2>

<h3>app模块</h3>

<h4>1 AndroidManifest.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.startservicefromanotherapp" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>        &lt;service
</span><span class='line'>            android:name=".AppService"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true" &gt;
</span><span class='line'>        &lt;/service&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h4>2 MainActivity(继承Activity)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        startService(new Intent(this,AppService.class));
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        stopService(new Intent(this,AppService.class));
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>3 AppService(继承Service)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        // TODO: Return the communication channel to the service.
</span><span class='line'>        throw new UnsupportedOperationException("Not yet implemented");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>4 activity_main.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin" tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView android:text="@string/hello_world" android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/RelativeLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>anotherapp模块</h3>

<h4>1 MainActivity(继承Activity，实现View.OnClickListener)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>2 activity_main.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[绑定Service进行通信（如何侦听Service的内部状态）]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/14/Service-is-bound-to-communicate-how-to-listen-to-the-internal-state-of-the-Service/"/>
    <updated>2015-07-14T00:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/14/Service-is-bound-to-communicate-how-to-listen-to-the-internal-state-of-the-Service</id>
    <content type="html"><![CDATA[<p>通过回调机制实现。当内部数据发生改变时，通知外部进行数据修改。</p>

<h2>示例代码</h2>

<h3>1 MainActivity（继承Activity，并实现View.OnClickListener, ServiceConnection）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.Handler;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.Message;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.support.v7.app.AppCompatActivity;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>import android.widget.TextView;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends AppCompatActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>  private EditText editText;
</span><span class='line'>  private Intent intent;
</span><span class='line'>  private MyService.Binder binder = null;
</span><span class='line'>  //步骤1
</span><span class='line'>  private TextView textViewOut;
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>      super.onCreate(savedInstanceState);
</span><span class='line'>      setContentView(R.layout.activity_main);
</span><span class='line'>      editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>      textViewOut = (TextView) findViewById(R.id.textViewOut);
</span><span class='line'>      findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnSyncData).setOnClickListener(this);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onClick(View v) {
</span><span class='line'>      switch (v.getId()){
</span><span class='line'>          case R.id.btnStartService:
</span><span class='line'>              System.out.println("启动服务");
</span><span class='line'>              intent = new Intent(this,MyService.class);
</span><span class='line'>              //传递名为“etData”的字符串类型的数据
</span><span class='line'>              intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>              startService(intent);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnStopService:
</span><span class='line'>              System.out.println("停止服务");
</span><span class='line'>              stopService(new Intent(this,MyService.class));
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnBindService:
</span><span class='line'>              bindService(new Intent(this,MyService.class),this, Context.BIND_AUTO_CREATE);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnUnbindService:
</span><span class='line'>              unbindService(this);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnSyncData:
</span><span class='line'>              if(binder!=null){
</span><span class='line'>                  binder.setData(editText.getText().toString());
</span><span class='line'>              }
</span><span class='line'>              break;
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>      //接收来自MyService的Binder中的数据
</span><span class='line'>      binder = (MyService.Binder) service;
</span><span class='line'>      //步骤7
</span><span class='line'>      binder.getService().setCallBack(new MyService.CallBack() {
</span><span class='line'>          @Override
</span><span class='line'>          public void onDataChange(String data) {
</span><span class='line'>              //textViewOut.setText(data);
</span><span class='line'>              //此处不能直接写,因为Android中有一个安全机制，即UI线程不允许其它辅线程直接修改UI线程的资源
</span><span class='line'>              //步骤9
</span><span class='line'>              Message msg = new Message();
</span><span class='line'>              Bundle bundle = new Bundle();
</span><span class='line'>              bundle.putString("data",data);
</span><span class='line'>              msg.setData(bundle);
</span><span class='line'>              handler.sendMessage(msg);
</span><span class='line'>          }
</span><span class='line'>      });
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>  //步骤8
</span><span class='line'>  private Handler handler = new Handler(){
</span><span class='line'>      @Override
</span><span class='line'>      public void handleMessage(Message msg) {
</span><span class='line'>          super.handleMessage(msg);
</span><span class='line'>          //步骤10
</span><span class='line'>          textViewOut.setText(msg.getData().getString("data"));
</span><span class='line'>      }
</span><span class='line'>  };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService(继承Service)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>  private static boolean ServiceRunning = false;
</span><span class='line'>  private String etData = "默认文本";
</span><span class='line'>  public MyService() {
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public IBinder onBind(Intent intent) {
</span><span class='line'>      return new Binder();
</span><span class='line'>  }
</span><span class='line'>  //创建一个Binder对象继承系统中的Binder类，并创建一个传递数据的方法setData
</span><span class='line'>  public class Binder extends android.os.Binder{
</span><span class='line'>      public void setData(String etData){
</span><span class='line'>          MyService.this.etData = etData;
</span><span class='line'>      }
</span><span class='line'>      //步骤6
</span><span class='line'>      public MyService getService(){
</span><span class='line'>          return MyService.this;
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>      etData = intent.getStringExtra("etData");
</span><span class='line'>      return super.onStartCommand(intent, flags, startId);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onCreate() {
</span><span class='line'>      super.onCreate();
</span><span class='line'>      System.out.println("服务创建");
</span><span class='line'>      ServiceRunning = true;
</span><span class='line'>      new Thread(){
</span><span class='line'>          @Override
</span><span class='line'>          public void run() {
</span><span class='line'>              super.run();
</span><span class='line'>              //步骤4
</span><span class='line'>              int i = 0;
</span><span class='line'>              while (ServiceRunning){
</span><span class='line'>                  i++;
</span><span class='line'>                  String str = i+"："+etData;
</span><span class='line'>                  System.out.println(str);
</span><span class='line'>                  //步骤5
</span><span class='line'>                  if(callBack!=null){
</span><span class='line'>                      callBack.onDataChange(str);
</span><span class='line'>                  }
</span><span class='line'>                  try {
</span><span class='line'>                      sleep(1000);
</span><span class='line'>                  } catch (InterruptedException e) {
</span><span class='line'>                      e.printStackTrace();
</span><span class='line'>                  }
</span><span class='line'>              }
</span><span class='line'>          }
</span><span class='line'>      }.start();
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>      public void onDestroy() {
</span><span class='line'>      super.onDestroy();
</span><span class='line'>      System.out.println("服务停止");
</span><span class='line'>      ServiceRunning = false;
</span><span class='line'>  }
</span><span class='line'>  //步骤3
</span><span class='line'>  private CallBack callBack = null;
</span><span class='line'>
</span><span class='line'>  public void setCallBack(CallBack callBack) {
</span><span class='line'>      this.callBack = callBack;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  public CallBack getCallBack() {
</span><span class='line'>      return callBack;
</span><span class='line'>  }
</span><span class='line'>  //步骤2
</span><span class='line'>  public static interface CallBack{
</span><span class='line'>      void onDataChange(String data);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>  android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>  android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>  android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>  android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>  android:orientation="vertical"
</span><span class='line'>  tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>  &lt;TextView
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="内部输出至外部测试文本"
</span><span class='line'>      android:id="@+id/textViewOut" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;EditText
</span><span class='line'>      android:layout_width="match_parent"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="默认文本"
</span><span class='line'>      android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="启动服务"
</span><span class='line'>      android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="停止服务"
</span><span class='line'>      android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>          android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="绑定服务"
</span><span class='line'>      android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="解除绑定服务"
</span><span class='line'>      android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="同步数据"
</span><span class='line'>      android:id="@+id/btnSyncData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[绑定Service通信（Binder方式）]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/13/Bind-Service-and-communicate-via-Binder/"/>
    <updated>2015-07-13T04:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/13/Bind-Service-and-communicate-via-Binder</id>
    <content type="html"><![CDATA[<p>绑定Service时，通过Binder方式进行数据传递，比通过启动Service的方式更方便也更高效。</p>

<h2>示例代码</h2>

<h3>1 MainActivity（继承Activity，实现View.OnClickListener, ServiceConnection接口）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private EditText editText;
</span><span class='line'>    private Intent intent;
</span><span class='line'>    private MyService.Binder binder = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnSyncData).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                System.out.println("启动服务");
</span><span class='line'>                intent = new Intent(this,MyService.class);
</span><span class='line'>                //传递名为“etData”的字符串类型的数据
</span><span class='line'>                intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                System.out.println("停止服务");
</span><span class='line'>                stopService(new Intent(this,MyService.class));
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnBindService:
</span><span class='line'>                bindService(new Intent(this,MyService.class),this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnSyncData:
</span><span class='line'>                if(binder!=null){
</span><span class='line'>                    binder.setData(editText.getText().toString());
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>  
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        //接收来自MyService的Binder中的数据
</span><span class='line'>      binder = (MyService.Binder) service;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    private static boolean ServiceRunning = false;
</span><span class='line'>    private String etData = "默认文本";
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //创建一个Binder对象继承系统中的Binder类，并创建一个传递数据的方法setData
</span><span class='line'>    public class Binder extends android.os.Binder{
</span><span class='line'>        public void setData(String etData){
</span><span class='line'>            MyService.this.etData = etData;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        etData = intent.getStringExtra("etData");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("服务创建");
</span><span class='line'>        ServiceRunning = true;
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (ServiceRunning){
</span><span class='line'>                    System.out.println(etData);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("服务停止");
</span><span class='line'>        ServiceRunning = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="默认文本"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定服务"
</span><span class='line'>        android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定服务"
</span><span class='line'>        android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="同步数据"
</span><span class='line'>        android:id="@+id/btnSyncData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[启动Service并传递数据]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/13/Start-Service-and-transfer-data/"/>
    <updated>2015-07-13T02:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/13/Start-Service-and-transfer-data</id>
    <content type="html"><![CDATA[<h2>示例代码</h2>

<h3>1 MainActivity（继承Activity,实现View.OnClickListener接口）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private EditText editText;
</span><span class='line'>    private Intent intent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                System.out.println("启动服务");
</span><span class='line'>                intent = new Intent(this,MyService.class);
</span><span class='line'>                //传递名为“etData”的字符串类型的数据
</span><span class='line'>                intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                System.out.println("停止服务");
</span><span class='line'>                stopService(new Intent(this,MyService.class));
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    private static boolean ServiceRunning = false;
</span><span class='line'>    private String etData = "默认文本";
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        etData = intent.getStringExtra("etData");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("服务创建");
</span><span class='line'>        ServiceRunning = true;
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (ServiceRunning){
</span><span class='line'>                    System.out.println(etData);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("服务停止");
</span><span class='line'>        ServiceRunning = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>    
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="默认文本"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[认识Android Service]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/13/Service-Android/"/>
    <updated>2015-07-13T01:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/13/Service-Android</id>
    <content type="html"><![CDATA[<h2>1 使用Service</h2>

<h3>1.1 认识Service</h3>

<p>Service与Activity的地位是并列的，它代表一个单独的Android组件。Service与Activity的区别在于：Service通常位于后台运行，它一般不需要与用户交互，因此Service组件没有图形用户界面。
与Activity组件需要继承Activity基类类似，Service组件需要继承Service基类。一个Service组件被运行起来之后，它将拥有自己独立的生命周期，Service组件通常用于为其他组件提供后台服务或监控其他组件的运行状态。</p>

<h3>1.2 使用场景</h3>

<p>不需要有可以与用户交互的界面，只需要在后台一直运行，做一些事务的处理，比如说Socket超链接、Http的网络通信以及与服务器保持推送的一个链接。<br/>
<strong>注意</strong>：Service实例在一个应用程序中只能有一个。</p>

<h2>2 绑定Service</h2>

<p>启动服务也可以通过绑定服务的方式启动。</p>

<h2>3 使用与绑定Service示例代码</h2>

<h3>3.1 MainActivity（继承Activity，实现View.OnClickListener, ServiceConnection）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent intent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        intent = new Intent(MainActivity.this,MyService.class);
</span><span class='line'>        //启动Service
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        //停止Service
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        //绑定Service
</span><span class='line'>        findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>        //解除绑定Service
</span><span class='line'>        findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>    //实现OnClickListener接口需要重写的方法
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnBindService:
</span><span class='line'>                bindService(intent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //实现ServiceConnection接口需要重写的方法
</span><span class='line'>    //服务被绑定成功执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Service Connected");
</span><span class='line'>    }
</span><span class='line'>    //实现ServiceConnection接口需要重写的方法
</span><span class='line'>    //服务解除绑定或者被杀掉时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3.2 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView android:text="@string/hello_world" android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定服务"
</span><span class='line'>        android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定服务"
</span><span class='line'>        android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3.3 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //返回一个实现了IBinder接口的对象
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //服务启动时所执行的命令示例
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (true) {
</span><span class='line'>                    System.out.println("服务正在运行...");
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>4 Service的生命周期</h2>

<p>与Service生命周期相关的函数为onCreate和onDestroy两个函数，其规律如下。<br/>
4.1 启动服务再绑定服务后，只能先解除绑定服务再停止服务才能真正停止掉服务。<br/>
4.2 启动服务后，退出程序，服务不会停止；再次进入程序停止服务，服务才会停止。<br/>
4.3 启动服务并绑定服务后，退出程序，也不会停止服务。需要解除绑定服务，并进行服务停止，才能真正停止服务。<br/>
4.4 Service中onCreate函数只会在最开始时执行一次，之后反复执行启动服务，只会反复执行onStartCommand函数。</p>

<h2>5 Service的停止与启动代码示例</h2>

<h3>5.1 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    //控制服务运行的开关
</span><span class='line'>    private boolean serviceRunning = false;
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //返回一个实现了IBinder接口的对象
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //服务启动时所执行的命令示例
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        System.out.println("Service onStartCommand");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service onCreate");
</span><span class='line'>        serviceRunning = true;
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (serviceRunning) {
</span><span class='line'>                    System.out.println("服务正在运行...");
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service onDestory");
</span><span class='line'>        serviceRunning = false;
</span><span class='line'>        System.out.println("服务停止运行！");
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Application的生命周期]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/12/Application-life-cycle/"/>
    <updated>2015-07-12T02:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/12/Application-life-cycle</id>
    <content type="html"><![CDATA[<h2>简  介</h2>

<p>当一个应用程序中有多个Activity时，不管先启动哪个Activity，Application里的onCreate函数都会先执行，这样就可以利用Application进行初始化操作。</p>

<h2>代  码</h2>

<h3>1 App(继承Application)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.app.Application;
</span><span class='line'>import android.content.res.Configuration;
</span><span class='line'>
</span><span class='line'>public class App extends Application {
</span><span class='line'>
</span><span class='line'>    private String textData = "default";
</span><span class='line'>    public void setTextData(String textData) {
</span><span class='line'>        this.textData = textData;
</span><span class='line'>    }
</span><span class='line'>    public String getTextData() {
</span><span class='line'>        return textData;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    //Application中生命周期相关的函数
</span><span class='line'>    //在创建程序时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("App onCreate");//当Application中onCreate执行时，会在控制台输出
</span><span class='line'>    }
</span><span class='line'>    //程序结束时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onTerminate() {
</span><span class='line'>        super.onTerminate();
</span><span class='line'>    }
</span><span class='line'>    //在低内存时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onLowMemory() {
</span><span class='line'>        super.onLowMemory();
</span><span class='line'>    }
</span><span class='line'>    //程序在进行内存清理时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onTrimMemory(int level) {
</span><span class='line'>        super.onTrimMemory(level);
</span><span class='line'>    }
</span><span class='line'>    //程序配置发生改变时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onConfigurationChanged(Configuration newConfig) {
</span><span class='line'>        super.onConfigurationChanged(newConfig);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 Main1(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.Menu;
</span><span class='line'>import android.view.MenuItem;
</span><span class='line'>
</span><span class='line'>public class Main1 extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        System.out.println("Main1 onCreate");//当Main1的onCreate函数执行时会在控制台输出
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 Main2(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.Menu;
</span><span class='line'>import android.view.MenuItem;
</span><span class='line'>
</span><span class='line'>public class Main2 extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        System.out.println("Main2 onCreate");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Application的用途]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/12/Application-uses/"/>
    <updated>2015-07-12T01:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/12/Application-uses</id>
    <content type="html"><![CDATA[<h2>简  介</h2>

<h3>1 Context的作用</h3>

<p>访问全局信息的接口，例如访问文字、图片资源等。</p>

<h3>2 Application的用途</h3>

<p>Application用于多个组件之间进行数据的共享，对于同一个应用来说是唯一的。</p>

<h2>代  码</h2>

<h3>1 App(继承Application)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>import android.app.Application;
</span><span class='line'>public class App extends Application {
</span><span class='line'>    private String textData = "default";
</span><span class='line'>    public void setTextData(String textData) {
</span><span class='line'>        this.textData = textData;
</span><span class='line'>    }
</span><span class='line'>    public String getTextData() {
</span><span class='line'>        return textData;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 Main1(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.Menu;
</span><span class='line'>import android.view.MenuItem;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>import android.widget.ImageView;
</span><span class='line'>import android.widget.TextView;
</span><span class='line'>
</span><span class='line'>public class Main1 extends ActionBarActivity {
</span><span class='line'>    private TextView textView;
</span><span class='line'>    private EditText editText;
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.main1);//绑定视图main1
</span><span class='line'>//        textView = new TextView(this);
</span><span class='line'>////        textView.setText("Hello Android!");
</span><span class='line'>//        textView.setText(R.string.hello_world);
</span><span class='line'>//        setContentView(textView);
</span><span class='line'>//
</span><span class='line'>//        System.out.println(getResources().getText(R.string.hello_world));
</span><span class='line'>//        ImageView iv = new ImageView(this);
</span><span class='line'>//        iv.setImageResource(R.mipmap.ic_launcher);
</span><span class='line'>//        setContentView(iv);
</span><span class='line'>
</span><span class='line'>        textView = (TextView) findViewById(R.id.textView);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>
</span><span class='line'>        textView.setText("共享的数据是："+getApp().getTextData());
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSaveData).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>            @Override
</span><span class='line'>            public void onClick(View v) {
</span><span class='line'>                //获取Application里的信息并保存到全局Context里面
</span><span class='line'>                ((App)getApplicationContext()).setTextData(editText.getText().toString());
</span><span class='line'>                //设置显示文本对象显示的文本
</span><span class='line'>                textView.setText("共享的数据是："+editText.getText().toString());
</span><span class='line'>            }
</span><span class='line'>        });
</span><span class='line'>
</span><span class='line'>    }
</span><span class='line'>    /**
</span><span class='line'>     * 获取Application中默认的数据
</span><span class='line'>     * @return
</span><span class='line'>     */
</span><span class='line'>    public App getApp(){
</span><span class='line'>        return (App)getApplicationContext();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 Main2.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="New Text"
</span><span class='line'>        android:id="@+id/textView" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="保存"
</span><span class='line'>        android:id="@+id/btnSaveData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3 Main2(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.app.Activity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>import android.widget.TextView;
</span><span class='line'>
</span><span class='line'>public class Main2 extends Activity {
</span><span class='line'>    private TextView textView;
</span><span class='line'>    private EditText editText;
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.main2);//绑定视图main2
</span><span class='line'>
</span><span class='line'>        textView = (TextView) findViewById(R.id.textView);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>
</span><span class='line'>        textView.setText("共享的数据是："+getApp().getTextData());
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSaveData).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>            @Override
</span><span class='line'>            public void onClick(View v) {
</span><span class='line'>                ((App)getApplicationContext()).setTextData(editText.getText().toString());
</span><span class='line'>                textView.setText("共享的数据是："+editText.getText().toString());
</span><span class='line'>            }
</span><span class='line'>        });
</span><span class='line'>    }
</span><span class='line'>    public App getApp(){
</span><span class='line'>        return (App)getApplicationContext();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 main2.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="New Text"
</span><span class='line'>        android:id="@+id/textView" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="保存"
</span><span class='line'>        android:id="@+id/btnSaveData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[通过浏览器链接启动本地Activity]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/10/Start-the-local-Activity-by-the-browser-link/"/>
    <updated>2015-07-10T06:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/10/Start-the-local-Activity-by-the-browser-link</id>
    <content type="html"><![CDATA[<h2>1 AndroidManifest.xml</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;activity
</span><span class='line'>    android:name=".LocalAppAty"
</span><span class='line'>    android:label="@string/title_activity_local_app_aty" &gt;
</span><span class='line'>    &lt;intent-filter&gt;
</span><span class='line'>        &lt;!-- 设置浏览器可启动 --&gt;
</span><span class='line'>        &lt;category android:name="android.intent.category.BROWSABLE"/&gt;
</span><span class='line'>        &lt;!-- 设置默认启动Activity --&gt;
</span><span class='line'>        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
</span><span class='line'>        &lt;!-- 浏览器链接被点击后，会发送一个View的action --&gt;
</span><span class='line'>        &lt;action android:name="android.intent.action.VIEW"/&gt;
</span><span class='line'>        &lt;!-- 设置协议为app --&gt;
</span><span class='line'>        &lt;data android:scheme="app"/&gt;
</span><span class='line'>    &lt;/intent-filter&gt;
</span><span class='line'>&lt;/activity&gt;</span></code></pre></td></tr></table></div></figure>


<h2>2 LocalAppAty.java</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>    super.onCreate(savedInstanceState);
</span><span class='line'>    setContentView(R.layout.activity_local_app_aty);
</span><span class='line'>    //接收从浏览器传过来的参数，接收到的是一个Uri（android.net）对象
</span><span class='line'>    Uri uri = getIntent().getData();
</span><span class='line'>  //通过浏览器链接打开应用后，会在控制台输出html页面中链接的uri地址“I/System.out﹕app://hello”
</span><span class='line'>    System.out.println(uri);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>3 写一个带链接的静态页面（test.html）</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!doctype html&gt;
</span><span class='line'>    &lt;html lang="en"&gt;
</span><span class='line'>    &lt;head&gt;
</span><span class='line'>        &lt;meta charset="UTF-8"&gt;
</span><span class='line'>        &lt;meta name="Generator" content="EditPlus®"&gt;
</span><span class='line'>        &lt;meta name="Author" content=""&gt;
</span><span class='line'>        &lt;meta name="Keywords" content=""&gt;
</span><span class='line'>        &lt;meta name="Description" content=""&gt;
</span><span class='line'>        &lt;style&gt;
</span><span class='line'>        a{
</span><span class='line'>            font-size:50pt;
</span><span class='line'>        }
</span><span class='line'>        &lt;/style&gt;
</span><span class='line'>        &lt;title&gt;Document&lt;/title&gt;
</span><span class='line'>    &lt;/head&gt;
</span><span class='line'>    &lt;body&gt;
</span><span class='line'>      &lt;a href="app://hello"&gt;Launch My App&lt;/a&gt;
</span><span class='line'>    &lt;/body&gt;
</span><span class='line'>&lt;/html&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Intent过滤器相关选项]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/10/Intent-filter-options/"/>
    <updated>2015-07-10T04:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/10/Intent-filter-options</id>
    <content type="html"><![CDATA[<p>*这里讨论当两个Activity的action相同的时候，如何启动相对应的Activity。</p>

<h2>1 AndroidManifest.xml</h2>

<p>其中，两个Activity的action的name都是"cn.loverobots.learnintent.intent.action.MyAty"。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;activity
</span><span class='line'>    android:name=".MyAty"
</span><span class='line'>    android:label="MyAty" &gt;
</span><span class='line'>    &lt;intent-filter&gt;
</span><span class='line'>        &lt;!-- 指定值为DEFAULT，则intent-filter的行为方式为Activity --&gt;
</span><span class='line'>        &lt;category android:name="android.intent.category.DEFAULT" /&gt;
</span><span class='line'>        &lt;!-- 指定启动字符串，其中约定成俗的字符串格式为：包名.intent.action.类名 --&gt;
</span><span class='line'>        &lt;action android:name="cn.loverobots.learnintent.intent.action.MyAty"/&gt;
</span><span class='line'>    &lt;/intent-filter&gt;
</span><span class='line'>&lt;/activity&gt;
</span><span class='line'>&lt;activity
</span><span class='line'>    android:name=".MyAty2"
</span><span class='line'>    android:label="@string/title_activity_my_aty2" &gt;
</span><span class='line'>    &lt;intent-filter&gt;
</span><span class='line'>        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
</span><span class='line'>        &lt;action android:name="cn.loverobots.learnintent.intent.action.MyAty"/&gt;
</span><span class='line'>      &lt;!-- 指定协议为app --&gt;
</span><span class='line'>        &lt;data android:scheme="app"/&gt;
</span><span class='line'>    &lt;/intent-filter&gt;
</span><span class='line'>&lt;/activity&gt;</span></code></pre></td></tr></table></div></figure>


<h2>2 当前应用程序的MainActivity.java</h2>

<p>则从当前应用程序的MainActivity启动另一个action时，会出现选择界面，需要手动选择启动哪一个Activity。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>    super.onCreate(savedInstanceState);
</span><span class='line'>    setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>    findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>        @Override
</span><span class='line'>        public void onClick(View v) {
</span><span class='line'>            //这种启动方法默认可以跨应用程序启动里面的Activity
</span><span class='line'>            startActivity(new Intent(MyAty.ACTION));
</span><span class='line'>        }
</span><span class='line'>    });
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>3 直接指定要启动的Activity</h2>

<p>要指定默认启动哪个Activity，需要利用Intent的构造函数中的重载函数，其第二个参数采用Uri.parse(&ldquo;app://hello&rdquo;)即可，其中“app”是在AndroidManifest.xml中为Activity指定的data android:scheme=&ldquo;app"。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        try {//由于不确定此字符串是否可调用，所以需要捕获异常
</span><span class='line'>            startActivity(new Intent("cn.loverobots.learnintent.intent.action.MyAty", Uri.parse("app://hello")));
</span><span class='line'>        }catch(Exception e){
</span><span class='line'>            Toast.makeText(MainActivity.this,"无法启动指定的Activity",Toast.LENGTH_SHORT).show();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[显示Intent与隐式Intent]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/10/Display-and-implicit-Intent/"/>
    <updated>2015-07-10T02:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/10/Display-and-implicit-Intent</id>
    <content type="html"><![CDATA[<h2>显示Intent</h2>

<p>即采用指定类的方式。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        startActivity(new Intent(MainActivity.this,MyAty.class));
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<h2>隐式Intent</h2>

<p>即采用指定字符串调用的方式。</p>

<h3>1 首先要在AndroidManifest.xml文件中指定对应字符串</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!-- exported的值默认为true，其它应用程序是可以直接访问的，指定为false，反之 --&gt;
</span><span class='line'>&lt;activity android:name=".MyAty" android:exported="false"&gt;
</span><span class='line'>    &lt;intent-filter&gt;
</span><span class='line'>        &lt;!-- 指定值为DEFAULT，则intent-filter的行为方式为Activity --&gt;
</span><span class='line'>        &lt;category android:name="android.intent.category.DEFAULT"/&gt;
</span><span class='line'>        &lt;!-- 指定启动字符串，其中约定成俗的字符串格式为：包名.intent.action.类名 --&gt;
</span><span class='line'>        &lt;action android:name="cn.loverobots.learnintent.intent.action.MyAty"/&gt;
</span><span class='line'>    &lt;/intent-filter&gt;
</span><span class='line'>&lt;/activity&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2 为了避免反复输入冗长的字符串，一般在被调用类中创建一个静态常量保存字符串</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class MyAty extends Activity {
</span><span class='line'>    //在类中创建静态常量ACTION，并赋值为启动字符串，方便其它Activity调用
</span><span class='line'>    public static final String ACTION = "cn.loverobots.learnintent.intent.action.MyAty";
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.myaty);//绑定myaty.xml视图文件
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 隐式Intent方式（程序LearnIntent中MainActivity.java调用）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        //这种启动方法默认可以跨应用程序启动里面的Activity
</span><span class='line'>        startActivity(new Intent(MyAty.ACTION));
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>


<h3>4 由于禁止跨程序调用（android:exported=&ldquo;false"），则需要在想要调用的程序中（另一个程序app1中MainActivity.java）捕获异常。</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        try {//由于不确定此字符串是否可调用，所以需要捕获异常
</span><span class='line'>            startActivity(new Intent("cn.loverobots.learnintent.intent.action.MyAty"));
</span><span class='line'>        }catch(Exception e){
</span><span class='line'>            Toast.makeText(MainActivity.this,"无法启动指定的Activity",Toast.LENGTH_SHORT).show();
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>});</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[手动创建Activity的过程]]></title>
    <link href="http://gitdeng.github.io/blog/2015/07/10/Manually-create-Activity/"/>
    <updated>2015-07-10T01:39:20+08:00</updated>
    <id>http://gitdeng.github.io/blog/2015/07/10/Manually-create-Activity</id>
    <content type="html"><![CDATA[<h2>1 创建一个类（MyAty.java）</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnintent;
</span><span class='line'>
</span><span class='line'>import android.app.Activity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>
</span><span class='line'>public class MyAty extends Activity {//继承Activity类
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {//重写onCreate方法
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.myaty);//绑定myaty.xml视图文件
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>2 创建视图文件（myaty.xml）</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;LinearLayout
</span><span class='line'>    xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="这是MyAty"
</span><span class='line'>        android:id="@+id/textMyAty" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3 在AndroidManifest.xml配置文件中注册新建的Activity</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnintent" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt; 
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>      &lt;!-- 注册MyAty类，其中前面的“.”符号，实际上是用来与package连接的，即MyAty类的完整地址是“cn.loverobots.learnintent.MyAty” --&gt;
</span><span class='line'>        &lt;activity android:name=".MyAty" /&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 测试新建Activity是否成功</h3>

<h4>4.1 MainActivity.java</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>@Override
</span><span class='line'>protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>    super.onCreate(savedInstanceState);
</span><span class='line'>    setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>    findViewById(R.id.btnStartMyAty).setOnClickListener(new View.OnClickListener() {
</span><span class='line'>        @Override
</span><span class='line'>        public void onClick(View v) {
</span><span class='line'>            startActivity(new Intent(MainActivity.this,MyAty.class));//显示Intent
</span><span class='line'>        }
</span><span class='line'>    });
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>4.2 activity_main.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout
</span><span class='line'>    xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools"
</span><span class='line'>    android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent"
</span><span class='line'>    android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动MyAty"
</span><span class='line'>        android:id="@+id/btnStartMyAty" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
</feed>
