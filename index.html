
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>程序员笔记</title>
  <meta name="author" content="程序员笔记">

  
  <meta name="description" content="使用简介 在AndroidManifest.xml文件中注册receiver时，可在过滤器中增加优先级设置(priority)，数字越大优先级越高，越早执行。 1
2
3
&lt;intent-filter android:priority="7"&gt; &lt;action android: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://gitdeng.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="程序员笔记" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">程序员笔记</a></h1>
  
    <h2>记录菜鸟程序员的成长旅程</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="gitdeng.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">文章总览</a></li>
  <li><a href="/blog/archives">标题总览</a></li>
  <li><a href="/blog/categories/basic-cognition">基本认识</a></li>
  <li><a href="/blog/categories/android-basic">Android基础知识</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/20/BroadcastReceiver-priority/">BroadcastReceiver的优先级</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-20T00:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>使用简介</h2>

<p>在AndroidManifest.xml文件中注册receiver时，可在过滤器中增加优先级设置(priority)，数字越大优先级越高，越早执行。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;intent-filter android:priority="7"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>&lt;/intent-filter&gt;</span></code></pre></td></tr></table></div></figure>


<h2>注意事项</h2>

<p>采用abordBroadcast();方法进行广播中断时，不能采用sendBroadcast(new Intent);方式进行广播发送，会报错（BroadcastReceiver trying to return result during a non-ordered broadcast），且不会有中断广播效果。应该采用sendOrderedBroadcast(i,null);方式发送广播。</p>

<h2>代码举例</h2>

<h3>1 AndroidManifest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnbroadcastreceiver" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>        &lt;receiver
</span><span class='line'>            android:name=".MyReceiver2"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true"&gt;
</span><span class='line'>            &lt;intent-filter android:priority="7"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/receiver&gt;
</span><span class='line'>        &lt;receiver
</span><span class='line'>            android:name=".MyReceiver"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true"&gt;
</span><span class='line'>            &lt;intent-filter android:priority="8"&gt;
</span><span class='line'>                &lt;action android:name="cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver"/&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/receiver&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.IntentFilter;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private MyReceiver receiver = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSendMsg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnReg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnreg).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch(v.getId()){
</span><span class='line'>            case R.id.btnSendMsg:
</span><span class='line'>//                Intent i = new Intent(this,MyReceiver.class);
</span><span class='line'>                //这时只能隐式Intent传递数据了
</span><span class='line'>                Intent i = new Intent(MyReceiver.ACTION);
</span><span class='line'>                i.putExtra("data","JACK的机器人");
</span><span class='line'>//                sendBroadcast(i);//采用abortBroadcast();中断广播后，不能再采用此方式会报错，不能被中断
</span><span class='line'>                //报错BroadcastReceiver trying to return result during a non-ordered broadcast后，采用方式
</span><span class='line'>                sendOrderedBroadcast(i,null);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnReg:
</span><span class='line'>                //为避免重复注册操作，加入判断条件
</span><span class='line'>                if(receiver == null){
</span><span class='line'>                    //初始化receiver
</span><span class='line'>                    receiver = new MyReceiver();
</span><span class='line'>                    registerReceiver(receiver,new IntentFilter(MyReceiver.ACTION));
</span><span class='line'>                    System.out.println("注册了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnreg:
</span><span class='line'>                if(receiver != null){
</span><span class='line'>                    unregisterReceiver(receiver);
</span><span class='line'>                    receiver = null;
</span><span class='line'>                    System.out.println("注消了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 MyReceiver.java(继承BroadcastReceiver)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver extends BroadcastReceiver {
</span><span class='line'>
</span><span class='line'>    public static final String ACTION = "cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver";
</span><span class='line'>
</span><span class='line'>    public MyReceiver() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>//        System.out.println("接收到了消息，消息的内容是："+intent.getStringExtra("data"));
</span><span class='line'>        System.out.println("MyReceiver 接收到了消息");
</span><span class='line'>        //中断广播可以让优先级比其低的receiver不再接收到消息
</span><span class='line'>        abortBroadcast();
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>4 MyReceiver2.java(继承BroadcastReceiver)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver2 extends BroadcastReceiver {
</span><span class='line'>    
</span><span class='line'>    public MyReceiver2() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>        System.out.println("MyReceiver2 接收到了消息");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>5 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="@string/hello_world"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="发送消息"
</span><span class='line'>        android:id="@+id/btnSendMsg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注册接收器"
</span><span class='line'>        android:id="@+id/btnReg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注销接收器"
</span><span class='line'>        android:id="@+id/btnUnreg" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/19/Dynamic%20registration%20and%20cancellation%20BroadcastReceiver/">动态注册和注销BroadcastReceiver</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-19T01:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>BroadcastReceiver简介</h2>

<p>BroadcastReceiver 是Android 四大基本组件之一，用于接收广播信息，如：开屏、锁屏、短信等等，在实际工作中用途非常广泛。</p>

<h2>动态注册和注销BroadcastReceiver</h2>

<p>有的情况下，我们不希望BroadcastReceiver始终处于侦听状态，这时就需要会注册和注销BroadcastReceiver。</p>

<h3>1 MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.IntentFilter;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private MyReceiver receiver = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnSendMsg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnReg).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnreg).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch(v.getId()){
</span><span class='line'>            case R.id.btnSendMsg:
</span><span class='line'>//                Intent i = new Intent(this,MyReceiver.class);
</span><span class='line'>                //这时只能隐式Intent传递数据了
</span><span class='line'>                Intent i = new Intent(MyReceiver.ACTION);
</span><span class='line'>                i.putExtra("data","JACK的机器人");
</span><span class='line'>                sendBroadcast(i);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnReg:
</span><span class='line'>                //为避免重复注册操作，加入判断条件
</span><span class='line'>                if(receiver == null){
</span><span class='line'>                    //初始化receiver
</span><span class='line'>                    receiver = new MyReceiver();
</span><span class='line'>                    registerReceiver(receiver,new IntentFilter(MyReceiver.ACTION));
</span><span class='line'>                    System.out.println("注册了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnreg:
</span><span class='line'>                if(receiver != null){
</span><span class='line'>                    unregisterReceiver(receiver);
</span><span class='line'>                    receiver = null;
</span><span class='line'>                    System.out.println("注消了接收器");
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyReceiver.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnbroadcastreceiver;
</span><span class='line'>
</span><span class='line'>import android.content.BroadcastReceiver;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>
</span><span class='line'>public class MyReceiver extends BroadcastReceiver {
</span><span class='line'>
</span><span class='line'>    public static final String ACTION = "cn.loverobots.learnbroadcastreceiver.intent.action.MyReceiver";
</span><span class='line'>
</span><span class='line'>    public MyReceiver() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onReceive(Context context, Intent intent) {
</span><span class='line'>        System.out.println("接收到了消息，消息的内容是："+intent.getStringExtra("data"));
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="@string/hello_world"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="发送消息"
</span><span class='line'>        android:id="@+id/btnSendMsg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注册接收器"
</span><span class='line'>        android:id="@+id/btnReg" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="注销接收器"
</span><span class='line'>        android:id="@+id/btnUnreg" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 AndroidMainfest.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.learnbroadcastreceiver" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/18/Cross-application-binding-Service-and-communication/">跨应用绑定Servic并通信</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-18T04:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>跨应用绑定Service的目的就是为了数据通信，如果不进行数据通信，跨应用绑定Service也就没有意义了。</p>

<h2>实现方法</h2>

<h3>（app中）</h3>

<h3>1 增加AIDL接口的抽象方法</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>    //步骤1 增加接口抽象方法
</span><span class='line'>    void setData(String data);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 AppService.java中实现接口抽象方法并增加测试线程</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>
</span><span class='line'>    private String data = "默认文本";
</span><span class='line'>    private boolean running = false;
</span><span class='line'>
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>
</span><span class='line'>        return new IAppServiceRemoteBinder.Stub() {
</span><span class='line'>            @Override
</span><span class='line'>            public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {
</span><span class='line'>
</span><span class='line'>            }
</span><span class='line'>            //步骤2 实现接口抽象方法
</span><span class='line'>            @Override
</span><span class='line'>            public void setData(String data) throws RemoteException {
</span><span class='line'>                AppService.this.data = data;
</span><span class='line'>            }
</span><span class='line'>
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>        //步骤3 添加测试线程
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                running = true;
</span><span class='line'>                while (running){
</span><span class='line'>                    System.out.println(data);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>        //步骤4 摧毁线程同时不再输出文本
</span><span class='line'>        running = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>（anotherapp中）</h3>

<h3>3 增加同步测试数据按钮</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动外部服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止外部服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定外部服务"
</span><span class='line'>        android:id="@+id/btnBindAppService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定外部服务"
</span><span class='line'>        android:id="@+id/btnUnbindAppService" /&gt;
</span><span class='line'>    //步骤5 增加同步测试数据按钮
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="这是另一个应用中的数据"
</span><span class='line'>        android:id="@+id/etInput" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="同步数据到绑定的服务中"
</span><span class='line'>        android:id="@+id/btnSync" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>4 从app中将aidl文件复制至anotherapp中（包名需保持一致）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>//步骤8 拷贝另一个应用中的aidl文件至当前应用中，需保证包名一致。然后Rebuild Project。
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>
</span><span class='line'>    void setData(String data);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p></p>

<h3>5 修改MainActivity.java</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>import cn.loverobots.startservicefromanotherapp.IAppServiceRemoteBinder;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>    private EditText etInput;
</span><span class='line'>    private IAppServiceRemoteBinder binder = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        //步骤7 设置接收编辑文本框数据的对象
</span><span class='line'>        etInput = (EditText) findViewById(R.id.etInput);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnBindAppService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindAppService).setOnClickListener(this);
</span><span class='line'>        //步骤6 绑定同步数据按钮监听事件
</span><span class='line'>        findViewById(R.id.btnSync).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>
</span><span class='line'>            case R.id.btnBindAppService:
</span><span class='line'>                bindService(ServiceIntent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindAppService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                binder = null;
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnSync:
</span><span class='line'>                //步骤9 将文本编辑框中数据通过binder方式传入
</span><span class='line'>                if(binder != null){
</span><span class='line'>                    try {
</span><span class='line'>                        binder.setData(etInput.getText().toString());
</span><span class='line'>                    } catch (RemoteException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Bind Service");
</span><span class='line'>        System.out.println(service);
</span><span class='line'>        //步骤10 绑定服务时，将获取的binder传入。
</span><span class='line'>        //不能使用binder = (IAppServiceRemoteBinder) service;直接进行强制类型转换，因为两者内存地址不一样
</span><span class='line'>        binder = IAppServiceRemoteBinder.Stub.asInterface(service);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>        System.out.println("Unbind Service");
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/18/Cross-application-binding-Service/">跨应用绑定Service</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-18T03:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>1 建立AIDL服务的步骤</h2>

<p>建立AIDL服务要比建立普通的服务复杂一些，具体步骤如下：<br/>
2.1 在Eclipse Android工程的Java包目录中建立一个扩展名为aidl的文件。该文件的语法类似于Java代码，但会稍有不同。<br/>
2.2 如果aidl文件的内容是正确的，ADT会自动生成一个Java接口文件（*.java）。<br/>
2.3 建立一个服务类（Service的子类）。<br/>
2.4 实现由aidl文件生成的Java接口。<br/>
2.5 在AndroidManifest.xml文件中配置AIDL服务，尤其要注意的是，<action>标签中android:name的属性值就是客户端要引用该服务的ID，也就是Intent类的参数值。</p>

<h2>2 跨应用绑定Service</h2>

<p>无法从其它的应用程序里面访问另一个应用程序里面的某一个类的定义，所以Android专门提供了一种机制，即AIDL——Android接口定义语言。</p>

<h3>2.1 创建aidl文件(IAppServiceRemoteBinder.aidl)</h3>

<p>模块名上右键创建AIDL File</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// IAppServiceRemoteBinder.aidl
</span><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>// Declare any non-default types here with import statements
</span><span class='line'>//步骤1 创建aidl文件
</span><span class='line'>interface IAppServiceRemoteBinder {
</span><span class='line'>    /**
</span><span class='line'>     * Demonstrates some basic types that you can use as parameters
</span><span class='line'>     * and return values in AIDL.
</span><span class='line'>     */
</span><span class='line'>    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,
</span><span class='line'>            double aDouble, String aString);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2.2 当前模块下的AppService类实现aidl接口</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.RemoteException;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //步骤2 实现aidl接口
</span><span class='line'>        return new IAppServiceRemoteBinder.Stub() {
</span><span class='line'>            @Override
</span><span class='line'>            public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {
</span><span class='line'>
</span><span class='line'>            }
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2.3 在anotherapp中布局文件（activity_main.xml）添加绑定及解绑服务按钮</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动外部服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止外部服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>    &lt;!--步骤3 添加绑定及解绑服务按钮--&gt;
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定外部服务"
</span><span class='line'>        android:id="@+id/btnBindAppService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定外部服务"
</span><span class='line'>        android:id="@+id/btnUnbindAppService" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>2.4 给按钮添加监听事件响应(anotherapp中的MainActivity.java)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        //步骤4
</span><span class='line'>        findViewById(R.id.btnBindAppService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindAppService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            //步骤5
</span><span class='line'>            case R.id.btnBindAppService:
</span><span class='line'>                bindService(ServiceIntent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindAppService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //步骤6
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Bind Service");
</span><span class='line'>        System.out.println(service);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>        System.out.println("Unbind Service");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/18/Cross-application-startup-Service/">跨应用启动Service</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-18T00:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Android中AIDL的理解</h2>

<h3>1 什么是AIDL</h3>

<p>Android系统中的进程之间不能共享内存，因此，需要提供一些机制在不同进程之间进行数据通信。为了使其他的应用程序也可以访问本应用程序提供的服务，Android系统采用了远程过程调用（Remote Procedure Call，RPC）方式来实现。与很多其他的基于RPC的解决方案一样，Android使用一种接口定义语言（Interface Definition Language，IDL）来公开服务的接口。<br/>
我们知道4个Android应用程序组件中的3个（Activity、BroadcastReceiver和ContentProvider）都可以进行跨进程访问，另外一个Android应用程序组件Service同样可以。因此，可以将这种可以跨进程访问的服务称为AIDL（Android Interface Definition Language）服务。</p>

<h3>2 跨应用启动Service</h3>

<p>从Android 5.0开始，如果想启动服务，必须使用显式Intent，不能够使用隐式Intent。</p>

<h2>跨应用启动Service</h2>

<h3>app模块</h3>

<h4>1 AndroidManifest.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="utf-8"?&gt;
</span><span class='line'>&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    package="cn.loverobots.startservicefromanotherapp" &gt;
</span><span class='line'>
</span><span class='line'>    &lt;application
</span><span class='line'>        android:allowBackup="true"
</span><span class='line'>        android:icon="@mipmap/ic_launcher"
</span><span class='line'>        android:label="@string/app_name"
</span><span class='line'>        android:theme="@style/AppTheme" &gt;
</span><span class='line'>        &lt;activity
</span><span class='line'>            android:name=".MainActivity"
</span><span class='line'>            android:label="@string/app_name" &gt;
</span><span class='line'>            &lt;intent-filter&gt;
</span><span class='line'>                &lt;action android:name="android.intent.action.MAIN" /&gt;
</span><span class='line'>                &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
</span><span class='line'>            &lt;/intent-filter&gt;
</span><span class='line'>        &lt;/activity&gt;
</span><span class='line'>
</span><span class='line'>        &lt;service
</span><span class='line'>            android:name=".AppService"
</span><span class='line'>            android:enabled="true"
</span><span class='line'>            android:exported="true" &gt;
</span><span class='line'>        &lt;/service&gt;
</span><span class='line'>    &lt;/application&gt;
</span><span class='line'>
</span><span class='line'>&lt;/manifest&gt;</span></code></pre></td></tr></table></div></figure>


<h4>2 MainActivity(继承Activity)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity {
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        startService(new Intent(this,AppService.class));
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        stopService(new Intent(this,AppService.class));
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>3 AppService(继承Service)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.startservicefromanotherapp;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class AppService extends Service {
</span><span class='line'>    public AppService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        // TODO: Return the communication channel to the service.
</span><span class='line'>        throw new UnsupportedOperationException("Not yet implemented");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service Started");
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service Destroyed");
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>4 activity_main.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin" tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView android:text="@string/hello_world" android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/RelativeLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>anotherapp模块</h3>

<h4>1 MainActivity(继承Activity，实现View.OnClickListener)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.anotherapp;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private Intent ServiceIntent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        ServiceIntent = new Intent();
</span><span class='line'>        //显式Intent方式启动Service
</span><span class='line'>        ServiceIntent.setComponent(new ComponentName("cn.loverobots.startservicefromanotherapp","cn.loverobots.startservicefromanotherapp.AppService"));
</span><span class='line'>
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(ServiceIntent);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h4>2 activity_main.xml</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView
</span><span class='line'>        android:text="跨应用启动服务测试"
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/14/Service-is-bound-to-communicate-how-to-listen-to-the-internal-state-of-the-Service/">绑定Service进行通信（如何侦听Service的内部状态）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-14T00:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>12:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>通过回调机制实现。当内部数据发生改变时，通知外部进行数据修改。</p>

<h2>示例代码</h2>

<h3>1 MainActivity（继承Activity，并实现View.OnClickListener, ServiceConnection）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.Handler;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.os.Message;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.support.v7.app.AppCompatActivity;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>import android.widget.TextView;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends AppCompatActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>  private EditText editText;
</span><span class='line'>  private Intent intent;
</span><span class='line'>  private MyService.Binder binder = null;
</span><span class='line'>  //步骤1
</span><span class='line'>  private TextView textViewOut;
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>      super.onCreate(savedInstanceState);
</span><span class='line'>      setContentView(R.layout.activity_main);
</span><span class='line'>      editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>      textViewOut = (TextView) findViewById(R.id.textViewOut);
</span><span class='line'>      findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>      findViewById(R.id.btnSyncData).setOnClickListener(this);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onClick(View v) {
</span><span class='line'>      switch (v.getId()){
</span><span class='line'>          case R.id.btnStartService:
</span><span class='line'>              System.out.println("启动服务");
</span><span class='line'>              intent = new Intent(this,MyService.class);
</span><span class='line'>              //传递名为“etData”的字符串类型的数据
</span><span class='line'>              intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>              startService(intent);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnStopService:
</span><span class='line'>              System.out.println("停止服务");
</span><span class='line'>              stopService(new Intent(this,MyService.class));
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnBindService:
</span><span class='line'>              bindService(new Intent(this,MyService.class),this, Context.BIND_AUTO_CREATE);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnUnbindService:
</span><span class='line'>              unbindService(this);
</span><span class='line'>              break;
</span><span class='line'>          case R.id.btnSyncData:
</span><span class='line'>              if(binder!=null){
</span><span class='line'>                  binder.setData(editText.getText().toString());
</span><span class='line'>              }
</span><span class='line'>              break;
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>      //接收来自MyService的Binder中的数据
</span><span class='line'>      binder = (MyService.Binder) service;
</span><span class='line'>      //步骤7
</span><span class='line'>      binder.getService().setCallBack(new MyService.CallBack() {
</span><span class='line'>          @Override
</span><span class='line'>          public void onDataChange(String data) {
</span><span class='line'>              //textViewOut.setText(data);
</span><span class='line'>              //此处不能直接写,因为Android中有一个安全机制，即UI线程不允许其它辅线程直接修改UI线程的资源
</span><span class='line'>              //步骤9
</span><span class='line'>              Message msg = new Message();
</span><span class='line'>              Bundle bundle = new Bundle();
</span><span class='line'>              bundle.putString("data",data);
</span><span class='line'>              msg.setData(bundle);
</span><span class='line'>              handler.sendMessage(msg);
</span><span class='line'>          }
</span><span class='line'>      });
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>  //步骤8
</span><span class='line'>  private Handler handler = new Handler(){
</span><span class='line'>      @Override
</span><span class='line'>      public void handleMessage(Message msg) {
</span><span class='line'>          super.handleMessage(msg);
</span><span class='line'>          //步骤10
</span><span class='line'>          textViewOut.setText(msg.getData().getString("data"));
</span><span class='line'>      }
</span><span class='line'>  };
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService(继承Service)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>  private static boolean ServiceRunning = false;
</span><span class='line'>  private String etData = "默认文本";
</span><span class='line'>  public MyService() {
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public IBinder onBind(Intent intent) {
</span><span class='line'>      return new Binder();
</span><span class='line'>  }
</span><span class='line'>  //创建一个Binder对象继承系统中的Binder类，并创建一个传递数据的方法setData
</span><span class='line'>  public class Binder extends android.os.Binder{
</span><span class='line'>      public void setData(String etData){
</span><span class='line'>          MyService.this.etData = etData;
</span><span class='line'>      }
</span><span class='line'>      //步骤6
</span><span class='line'>      public MyService getService(){
</span><span class='line'>          return MyService.this;
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>      etData = intent.getStringExtra("etData");
</span><span class='line'>      return super.onStartCommand(intent, flags, startId);
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>  public void onCreate() {
</span><span class='line'>      super.onCreate();
</span><span class='line'>      System.out.println("服务创建");
</span><span class='line'>      ServiceRunning = true;
</span><span class='line'>      new Thread(){
</span><span class='line'>          @Override
</span><span class='line'>          public void run() {
</span><span class='line'>              super.run();
</span><span class='line'>              //步骤4
</span><span class='line'>              int i = 0;
</span><span class='line'>              while (ServiceRunning){
</span><span class='line'>                  i++;
</span><span class='line'>                  String str = i+"："+etData;
</span><span class='line'>                  System.out.println(str);
</span><span class='line'>                  //步骤5
</span><span class='line'>                  if(callBack!=null){
</span><span class='line'>                      callBack.onDataChange(str);
</span><span class='line'>                  }
</span><span class='line'>                  try {
</span><span class='line'>                      sleep(1000);
</span><span class='line'>                  } catch (InterruptedException e) {
</span><span class='line'>                      e.printStackTrace();
</span><span class='line'>                  }
</span><span class='line'>              }
</span><span class='line'>          }
</span><span class='line'>      }.start();
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  @Override
</span><span class='line'>      public void onDestroy() {
</span><span class='line'>      super.onDestroy();
</span><span class='line'>      System.out.println("服务停止");
</span><span class='line'>      ServiceRunning = false;
</span><span class='line'>  }
</span><span class='line'>  //步骤3
</span><span class='line'>  private CallBack callBack = null;
</span><span class='line'>
</span><span class='line'>  public void setCallBack(CallBack callBack) {
</span><span class='line'>      this.callBack = callBack;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  public CallBack getCallBack() {
</span><span class='line'>      return callBack;
</span><span class='line'>  }
</span><span class='line'>  //步骤2
</span><span class='line'>  public static interface CallBack{
</span><span class='line'>      void onDataChange(String data);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>  android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>  android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>  android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>  android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>  android:orientation="vertical"
</span><span class='line'>  tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>  &lt;TextView
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="内部输出至外部测试文本"
</span><span class='line'>      android:id="@+id/textViewOut" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;EditText
</span><span class='line'>      android:layout_width="match_parent"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="默认文本"
</span><span class='line'>      android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="启动服务"
</span><span class='line'>      android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="停止服务"
</span><span class='line'>      android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>          android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="绑定服务"
</span><span class='line'>      android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="解除绑定服务"
</span><span class='line'>      android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>  &lt;Button
</span><span class='line'>      android:layout_width="wrap_content"
</span><span class='line'>      android:layout_height="wrap_content"
</span><span class='line'>      android:text="同步数据"
</span><span class='line'>      android:id="@+id/btnSyncData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/13/Bind-Service-and-communicate-via-Binder/">绑定Service通信（Binder方式）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-13T04:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>4:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>绑定Service时，通过Binder方式进行数据传递，比通过启动Service的方式更方便也更高效。</p>

<h2>示例代码</h2>

<h3>1 MainActivity（继承Activity，实现View.OnClickListener, ServiceConnection接口）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private EditText editText;
</span><span class='line'>    private Intent intent;
</span><span class='line'>    private MyService.Binder binder = null;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnSyncData).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                System.out.println("启动服务");
</span><span class='line'>                intent = new Intent(this,MyService.class);
</span><span class='line'>                //传递名为“etData”的字符串类型的数据
</span><span class='line'>                intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                System.out.println("停止服务");
</span><span class='line'>                stopService(new Intent(this,MyService.class));
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnBindService:
</span><span class='line'>                bindService(new Intent(this,MyService.class),this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnSyncData:
</span><span class='line'>                if(binder!=null){
</span><span class='line'>                    binder.setData(editText.getText().toString());
</span><span class='line'>                }
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>  
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        //接收来自MyService的Binder中的数据
</span><span class='line'>      binder = (MyService.Binder) service;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    private static boolean ServiceRunning = false;
</span><span class='line'>    private String etData = "默认文本";
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //创建一个Binder对象继承系统中的Binder类，并创建一个传递数据的方法setData
</span><span class='line'>    public class Binder extends android.os.Binder{
</span><span class='line'>        public void setData(String etData){
</span><span class='line'>            MyService.this.etData = etData;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        etData = intent.getStringExtra("etData");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("服务创建");
</span><span class='line'>        ServiceRunning = true;
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (ServiceRunning){
</span><span class='line'>                    System.out.println(etData);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("服务停止");
</span><span class='line'>        ServiceRunning = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="默认文本"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定服务"
</span><span class='line'>        android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定服务"
</span><span class='line'>        android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="同步数据"
</span><span class='line'>        android:id="@+id/btnSyncData" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/13/Start-Service-and-transfer-data/">启动Service并传递数据</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-13T02:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>示例代码</h2>

<h3>1 MainActivity（继承Activity,实现View.OnClickListener接口）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>import android.widget.EditText;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener {
</span><span class='line'>
</span><span class='line'>    private EditText editText;
</span><span class='line'>    private Intent intent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>        editText = (EditText) findViewById(R.id.editText);
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                System.out.println("启动服务");
</span><span class='line'>                intent = new Intent(this,MyService.class);
</span><span class='line'>                //传递名为“etData”的字符串类型的数据
</span><span class='line'>                intent.putExtra("etData", editText.getText().toString());
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                System.out.println("停止服务");
</span><span class='line'>                stopService(new Intent(this,MyService.class));
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.connectservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    private static boolean ServiceRunning = false;
</span><span class='line'>    private String etData = "默认文本";
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        etData = intent.getStringExtra("etData");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("服务创建");
</span><span class='line'>        ServiceRunning = true;
</span><span class='line'>        new Thread(){
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (ServiceRunning){
</span><span class='line'>                    System.out.println(etData);
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("服务停止");
</span><span class='line'>        ServiceRunning = false;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>    
</span><span class='line'>    &lt;EditText
</span><span class='line'>        android:layout_width="match_parent"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="默认文本"
</span><span class='line'>        android:id="@+id/editText" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/13/Service-Android/">认识Android Service</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-13T01:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>1 使用Service</h2>

<h3>1.1 认识Service</h3>

<p>Service与Activity的地位是并列的，它代表一个单独的Android组件。Service与Activity的区别在于：Service通常位于后台运行，它一般不需要与用户交互，因此Service组件没有图形用户界面。
与Activity组件需要继承Activity基类类似，Service组件需要继承Service基类。一个Service组件被运行起来之后，它将拥有自己独立的生命周期，Service组件通常用于为其他组件提供后台服务或监控其他组件的运行状态。</p>

<h3>1.2 使用场景</h3>

<p>不需要有可以与用户交互的界面，只需要在后台一直运行，做一些事务的处理，比如说Socket超链接、Http的网络通信以及与服务器保持推送的一个链接。<br/>
<strong>注意</strong>：Service实例在一个应用程序中只能有一个。</p>

<h2>2 绑定Service</h2>

<p>启动服务也可以通过绑定服务的方式启动。</p>

<h2>3 使用与绑定Service示例代码</h2>

<h3>3.1 MainActivity（继承Activity，实现View.OnClickListener, ServiceConnection）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.content.ComponentName;
</span><span class='line'>import android.content.Context;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.content.ServiceConnection;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.View;
</span><span class='line'>
</span><span class='line'>public class MainActivity extends ActionBarActivity implements View.OnClickListener, ServiceConnection {
</span><span class='line'>
</span><span class='line'>    private Intent intent;
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        setContentView(R.layout.activity_main);
</span><span class='line'>
</span><span class='line'>        intent = new Intent(MainActivity.this,MyService.class);
</span><span class='line'>        //启动Service
</span><span class='line'>        findViewById(R.id.btnStartService).setOnClickListener(this);
</span><span class='line'>        //停止Service
</span><span class='line'>        findViewById(R.id.btnStopService).setOnClickListener(this);
</span><span class='line'>        //绑定Service
</span><span class='line'>        findViewById(R.id.btnBindService).setOnClickListener(this);
</span><span class='line'>        //解除绑定Service
</span><span class='line'>        findViewById(R.id.btnUnbindService).setOnClickListener(this);
</span><span class='line'>    }
</span><span class='line'>    //实现OnClickListener接口需要重写的方法
</span><span class='line'>    @Override
</span><span class='line'>    public void onClick(View v) {
</span><span class='line'>        switch (v.getId()){
</span><span class='line'>            case R.id.btnStartService:
</span><span class='line'>                startService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnStopService:
</span><span class='line'>                stopService(intent);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnBindService:
</span><span class='line'>                bindService(intent,this, Context.BIND_AUTO_CREATE);
</span><span class='line'>                break;
</span><span class='line'>            case R.id.btnUnbindService:
</span><span class='line'>                unbindService(this);
</span><span class='line'>                break;
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    //实现ServiceConnection接口需要重写的方法
</span><span class='line'>    //服务被绑定成功执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceConnected(ComponentName name, IBinder service) {
</span><span class='line'>        System.out.println("Service Connected");
</span><span class='line'>    }
</span><span class='line'>    //实现ServiceConnection接口需要重写的方法
</span><span class='line'>    //服务解除绑定或者被杀掉时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onServiceDisconnected(ComponentName name) {
</span><span class='line'>
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3.2 activity_main.xml</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
</span><span class='line'>    xmlns:tools="http://schemas.android.com/tools" android:layout_width="match_parent"
</span><span class='line'>    android:layout_height="match_parent" android:paddingLeft="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingRight="@dimen/activity_horizontal_margin"
</span><span class='line'>    android:paddingTop="@dimen/activity_vertical_margin"
</span><span class='line'>    android:paddingBottom="@dimen/activity_vertical_margin"
</span><span class='line'>    android:orientation="vertical"
</span><span class='line'>    tools:context=".MainActivity"&gt;
</span><span class='line'>
</span><span class='line'>    &lt;TextView android:text="@string/hello_world" android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="启动服务"
</span><span class='line'>        android:id="@+id/btnStartService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="停止服务"
</span><span class='line'>        android:id="@+id/btnStopService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="绑定服务"
</span><span class='line'>        android:id="@+id/btnBindService" /&gt;
</span><span class='line'>
</span><span class='line'>    &lt;Button
</span><span class='line'>        android:layout_width="wrap_content"
</span><span class='line'>        android:layout_height="wrap_content"
</span><span class='line'>        android:text="解除绑定服务"
</span><span class='line'>        android:id="@+id/btnUnbindService" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;/LinearLayout&gt;</span></code></pre></td></tr></table></div></figure>


<h3>3.3 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //返回一个实现了IBinder接口的对象
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //服务启动时所执行的命令示例
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (true) {
</span><span class='line'>                    System.out.println("服务正在运行...");
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>4 Service的生命周期</h2>

<p>与Service生命周期相关的函数为onCreate和onDestroy两个函数，其规律如下。<br/>
4.1 启动服务再绑定服务后，只能先解除绑定服务再停止服务才能真正停止掉服务。<br/>
4.2 启动服务后，退出程序，服务不会停止；再次进入程序停止服务，服务才会停止。<br/>
4.3 启动服务并绑定服务后，退出程序，也不会停止服务。需要解除绑定服务，并进行服务停止，才能真正停止服务。<br/>
4.4 Service中onCreate函数只会在最开始时执行一次，之后反复执行启动服务，只会反复执行onStartCommand函数。</p>

<h2>5 Service的停止与启动代码示例</h2>

<h3>5.1 MyService（继承Service）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learnservice;
</span><span class='line'>
</span><span class='line'>import android.app.Service;
</span><span class='line'>import android.content.Intent;
</span><span class='line'>import android.os.Binder;
</span><span class='line'>import android.os.IBinder;
</span><span class='line'>
</span><span class='line'>public class MyService extends Service {
</span><span class='line'>    //控制服务运行的开关
</span><span class='line'>    private boolean serviceRunning = false;
</span><span class='line'>
</span><span class='line'>    public MyService() {
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public IBinder onBind(Intent intent) {
</span><span class='line'>        //返回一个实现了IBinder接口的对象
</span><span class='line'>        return new Binder();
</span><span class='line'>    }
</span><span class='line'>    //服务启动时所执行的命令示例
</span><span class='line'>    @Override
</span><span class='line'>    public int onStartCommand(Intent intent, int flags, int startId) {
</span><span class='line'>        System.out.println("Service onStartCommand");
</span><span class='line'>        return super.onStartCommand(intent, flags, startId);
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("Service onCreate");
</span><span class='line'>        serviceRunning = true;
</span><span class='line'>        new Thread() {
</span><span class='line'>            @Override
</span><span class='line'>            public void run() {
</span><span class='line'>                super.run();
</span><span class='line'>                while (serviceRunning) {
</span><span class='line'>                    System.out.println("服务正在运行...");
</span><span class='line'>                    try {
</span><span class='line'>                        sleep(1000);
</span><span class='line'>                    } catch (InterruptedException e) {
</span><span class='line'>                        e.printStackTrace();
</span><span class='line'>                    }
</span><span class='line'>                }
</span><span class='line'>            }
</span><span class='line'>        }.start();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    @Override
</span><span class='line'>    public void onDestroy() {
</span><span class='line'>        super.onDestroy();
</span><span class='line'>        System.out.println("Service onDestory");
</span><span class='line'>        serviceRunning = false;
</span><span class='line'>        System.out.println("服务停止运行！");
</span><span class='line'>    }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/12/Application-life-cycle/">Application的生命周期</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-07-12T02:39:20+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>12</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>2:39 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>简  介</h2>

<p>当一个应用程序中有多个Activity时，不管先启动哪个Activity，Application里的onCreate函数都会先执行，这样就可以利用Application进行初始化操作。</p>

<h2>代  码</h2>

<h3>1 App(继承Application)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.app.Application;
</span><span class='line'>import android.content.res.Configuration;
</span><span class='line'>
</span><span class='line'>public class App extends Application {
</span><span class='line'>
</span><span class='line'>    private String textData = "default";
</span><span class='line'>    public void setTextData(String textData) {
</span><span class='line'>        this.textData = textData;
</span><span class='line'>    }
</span><span class='line'>    public String getTextData() {
</span><span class='line'>        return textData;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    //Application中生命周期相关的函数
</span><span class='line'>    //在创建程序时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onCreate() {
</span><span class='line'>        super.onCreate();
</span><span class='line'>        System.out.println("App onCreate");//当Application中onCreate执行时，会在控制台输出
</span><span class='line'>    }
</span><span class='line'>    //程序结束时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onTerminate() {
</span><span class='line'>        super.onTerminate();
</span><span class='line'>    }
</span><span class='line'>    //在低内存时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onLowMemory() {
</span><span class='line'>        super.onLowMemory();
</span><span class='line'>    }
</span><span class='line'>    //程序在进行内存清理时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onTrimMemory(int level) {
</span><span class='line'>        super.onTrimMemory(level);
</span><span class='line'>    }
</span><span class='line'>    //程序配置发生改变时执行
</span><span class='line'>    @Override
</span><span class='line'>    public void onConfigurationChanged(Configuration newConfig) {
</span><span class='line'>        super.onConfigurationChanged(newConfig);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>2 Main1(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.Menu;
</span><span class='line'>import android.view.MenuItem;
</span><span class='line'>
</span><span class='line'>public class Main1 extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        System.out.println("Main1 onCreate");//当Main1的onCreate函数执行时会在控制台输出
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>3 Main2(Activity)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package cn.loverobots.learncontext;
</span><span class='line'>
</span><span class='line'>import android.support.v7.app.ActionBarActivity;
</span><span class='line'>import android.os.Bundle;
</span><span class='line'>import android.view.Menu;
</span><span class='line'>import android.view.MenuItem;
</span><span class='line'>
</span><span class='line'>public class Main2 extends ActionBarActivity {
</span><span class='line'>    @Override
</span><span class='line'>    protected void onCreate(Bundle savedInstanceState) {
</span><span class='line'>        super.onCreate(savedInstanceState);
</span><span class='line'>        System.out.println("Main2 onCreate");
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; 前一页</a>
    
    <a href="/blog/archives">目录总览</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/20/BroadcastReceiver-priority/">BroadcastReceiver的优先级</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/19/Dynamic%20registration%20and%20cancellation%20BroadcastReceiver/">动态注册和注销BroadcastReceiver</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/18/Cross-application-binding-Service-and-communication/">跨应用绑定Servic并通信</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/18/Cross-application-binding-Service/">跨应用绑定Service</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/18/Cross-application-startup-Service/">跨应用启动Service</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 程序员笔记 -
  <span class="credit">Powered by <a href="http://www.loverobots.cn/">JACK的机器人</a></span>
</p>

</footer>
  











</body>
</html>
